var xx = xx || {};
;(function(){
    /**
     * @class ImgLoader 图片加载
     * @method load 开始加载
     * @property {string} basePath  路径
     * @property {string} crossOrigin 源
     * @property {array} loadType 自定义路径名['_src','_src1','img/i1.jpg'……]
     * @property {number} time 单张图片最大加载时间
     * @property {function} onProgress 加载进度
     * @property {function} onComplete 加载完成
     */
    function ImgLoader(){this.basePath="";this.crossOrigin="";this.loadType=['_src'];this.time=5000;this.onProgress=function(plan){};this.onComplete=function(){}}ImgLoader.prototype.load=function(){var that=this;var loadItem=this._createQueue(this.loadType);var total=loadItem.length,loaded=0,isOvertime=false,timer,time=this.time;if(total==0){that.onComplete()}else{timer=setTimeout(function(){isOvertime=true;that.onComplete()},time*total);for(var i=0;i<total;i++){this._loadOnce(loadItem[i],loading)}}function loading(){loaded++;var plan=Math.ceil(loaded/total*100);that.onProgress(plan);if(plan==100&&!isOvertime){clearTimeout(timer);that.onComplete()}}};ImgLoader.prototype._createQueue=function(loadType){var that=this;var loadItem=[];for(var i=0;i<loadType.length;i++){if(/.jpg|.png|.gif/i.test(loadType[i])){var img=new Image();if(that.crossOrigin){img.crossOrigin=that.crossOrigin}loadItem.push({tag:img,src:that.basePath+loadType[i]})}else{var $aImg=$('img['+loadType[i]+']');$aImg.each(function(index,dom){if(that.crossOrigin){dom.crossOrigin=that.crossOrigin}loadItem.push({tag:dom,src:that.basePath+$(dom).attr(loadType[i])})})}};return loadItem};ImgLoader.prototype._loadOnce=function(item,callback){var tag=item.tag;tag.src=item.src;if(tag.complete){callback()}else{tag.onload=function(){tag.onload=null;callback()};tag.onerror=function(){tag.onerror=null;callback()}}}
    //############# API ####################
    xx.ImgLoader=ImgLoader;
})();
